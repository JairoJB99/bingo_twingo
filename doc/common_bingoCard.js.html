<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: common/bingoCard.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: common/bingoCard.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Class BingoCard
 * In the BingoCard class, it is where we define the arrangement with the 9 numbers that can be in each of the three rows of the bingo card 
 * to be able to determine which cell of the card will be occupied by a number or will be empty.
 * We also make a Transpose matrix to fill all cells with random numbers
 * As well as rendering the cardboard in a literal template
 */

export class BingoCard{   
    
     constructor(player_,rootElement=undefined,pubSub=undefined){
          let player = player_;
          let templateRow = [0,1,2,3,4,5,6,7,8];
          let cardMatrix = [[...templateRow],[...templateRow],[...templateRow]];
          
        
          //Frontend have DOMelement to render. Backend not
          let divRoot;
          if (rootElement) {
               divRoot = document.createElement('div');
               divRoot.classList.add('bingoCardLayout');          
               rootElement.appendChild(divRoot);
          }

          //Transpose matrix to fullfill all cells with random numbers
          let transposedcardMatrix=transpose(cardMatrix);
          transposedcardMatrix.forEach((colCard,index) =>{   
               transposedcardMatrix[index] = getRandomArbitrary(index*10,(index*10)+10,3);
          });     
          
          //Again transpose to get original shape          
          cardMatrix = transpose(transposedcardMatrix);                            
                        
          let row1Blanks=getBlanks(templateRow);//Get four empty cells
          let row2Blanks=getBlanks(templateRow);//Get four empty cells
          //Pass two arrays eliminate numbers duplicates on both and from resulting array pick only an array of 4 elements
          let duplicatesNonSelectable=row1Blanks.filter(function(i){ return row2Blanks.indexOf(i) >= 0; });  
          let templateRow1 = [...templateRow];
          duplicatesNonSelectable.forEach((elem)=> templateRow1[elem]=null);
          let row3Blanks=getBlanks(templateRow1.filter((elem)=> elem!=null));
          
          row1Blanks.forEach((elem)=>cardMatrix[0][elem]=null);//Put a null in every empty picked cell row1
          row2Blanks.forEach((elem)=>cardMatrix[1][elem]=null);//Put a null in every empty picked cell row2
          row3Blanks.forEach((elem)=>cardMatrix[2][elem]=null);  
         //Render card 
          let render = (extractedBalls=[]) => {
               
               let out =`&lt;h1>Player ${player}&lt;/h1>
                    &lt;table class='bingoCard'>
                    `+
                         cardMatrix.map((value) => 
                         "&lt;tr>"+value.map((val) =>{
                              if (val==null){
                                   return "&lt;th class='nulo'>&lt;/th>"
                              }else{
                                   if (extractedBalls &amp;&amp; extractedBalls.indexOf(val) >= 0){
                                   if (val===extractedBalls[extractedBalls.length-1]){
                                        return "&lt;th class='extracted blink'>"+val+"&lt;/th>";                                  
                                   }else{
                                        return "&lt;th class='extracted'>"+val+"&lt;/th>";                                  
                                   }
                                   }else{
                                        return "&lt;th>"+val+"&lt;/th>"
                                   }
                              }}).join("")
                         +"&lt;/tr>"                          
                         ).join("")+
                    `&lt;/table>`;
                    divRoot.innerHTML = out;
                    //Every time we render the bingo card we should checkBingoOrLine
                    checkBingo(cardMatrix,extractedBalls,pubSub,player); 
          }
          if (pubSub) pubSub.subscribe("New Number",render);
          this.getMatrix = ()=> cardMatrix;          
     }        
}
/**
 * Function checkBingo 
 * which we use to know when the line has gone out and bingo 
 * to post it with the post pattern so that we can only sing line and bingo once per game.
 * @param {*} cardMatrix 
 * @param {*} extractedBalls 
 * @param {*} pubSub 
 * @param {*} player 
 */

function checkBingo(cardMatrix,extractedBalls,pubSub,player){
     let bingo=true;     
     cardMatrix.forEach((row)=>{
          let linia = row.filter((val)=> {if (extractedBalls.indexOf(val)&lt;=0) return val }).length;         
          if (linia>0) bingo=false; 
          else pubSub.publish("LINIA",player);       
     })     

     if (bingo) {
          pubSub.publish("BINGO",player)
          //debug("BINGO "+player)
     }
}
/**
 * Returns count random numbers between min (inclusive) and max (exclusive)
*/
function getRandomArbitrary(min, max,count) {
     if (min==0) min=1; //Exception first column from 1 to 9
     if (max==90) max=91; //Exception last column from 80 to 90
     let arr3=[]
     do{
          let randN=Math.floor(Math.random() * (max - min) + min);
          if (!arr3.includes(randN)) arr3.push(randN);
     }while(arr3.length!=count)              
     return arr3.sort();               
}

/**
 * Pass an array and we ramdomly pick only an array of 4 elements supposed to be blanks
 */

function getBlanks([...ai]){     
     let iterator=Array.apply(null, Array(ai.length-4));     
     iterator.forEach((el)=>{
          ai.splice(Math.floor(Math.random()*ai.length),1);          
     });
     return ai;                    
}
/**
 * //Transpose a matrix
 * @param {*} matrix 
 */

function transpose(matrix){          
     return matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));    
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BingoCard.html">BingoCard</a></li><li><a href="Bombo.html">Bombo</a></li></ul><h3>Global</h3><ul><li><a href="global.html#app">app</a></li><li><a href="global.html#checkBingo">checkBingo</a></li><li><a href="global.html#clearModal">clearModal</a></li><li><a href="global.html#debugOption">debugOption</a></li><li><a href="global.html#docReady">docReady</a></li><li><a href="global.html#getBlanks">getBlanks</a></li><li><a href="global.html#getRandomArbitrary">getRandomArbitrary</a></li><li><a href="global.html#imgsBingo">imgsBingo</a></li><li><a href="global.html#modalPlayers">modalPlayers</a></li><li><a href="global.html#randomBingo">randomBingo</a></li><li><a href="global.html#setupAudioBingoWin">setupAudioBingoWin</a></li><li><a href="global.html#setupBackgroundVideo">setupBackgroundVideo</a></li><li><a href="global.html#showModal">showModal</a></li><li><a href="global.html#transpose">transpose</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Thu Dec 03 2020 17:40:56 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
